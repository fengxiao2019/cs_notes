你是如何完善监控指标的？

这里的监控可以分成两个层面：第一，业务层面的监控，第二，系统资源层面的监控。
先说下业务层面的监控，业务层面其实也可以分成两块，一块是业务API的监控，另一块是业务数据的监控。由于我们系统的业务数据上的监控与统计功能有很多重叠的地方，所以数据上的监控都在统计那块。
业务API的监控主要监控的是API可用性、正确性、响应时间，从处理过程来看，可以从采集、存储、分析、展示、报警、处理6个环节去设计。

我们公司采用的Prometheus 和 Grafana 来监控资源、业务等。对于HTTP接口的采集，通过采集openresty上的日志信息，配置关键API的对应的规则。
![][image-1]
我们公司主要是催收业务，我们更关注的案件列表页、案件详情页、拆分案件这几个页面相关API的监控。
补充信息
- 案件列表页API只有一个，但是查询的复杂性比较高。
- 详情页涉及10+API，包括催记信息、债务人信息、联系人信息、补充联系人、案件还款记录、案件基本信息、案件当前贷款金额相关信息等等。
[https://www.apiscience.com/][1]
具体的规则：
- 案件列表页的规则：
- 案件详情页的规则：

**[故障处理流程？][2]**
这个要看具体的场景，归纳概括下来可以从这几个方面去处理。
1. 重启和限流。重启和限流主要是解决的可用性问题。重启，例如内存暴涨，cpu占用率太高，可以临时使用重启线解决问题，保证可用性，然后再仔细分析。限流的话，就需要配合流控中间件了。
2. 代码回滚。这个一般针对新代码引入的bug这类问题，针对这类问题代码回滚是最快的处理方式了。
3. 系统降级。如果代码无法回滚（或者回滚耗时比较长），可以考虑降级，提供有损服务，降低影响面。
4. 紧急更新。问题可以快速定位，具备完善的自动化部署以及测试系统，可以执行这一步。

故障前的准备工作
- 掌握用户功能全流程以及涉及到的资源，以及资源可能出现的故障和应对方案。这个是个不断迭代的过程，可以是以文档的形式、也可以是以系统的形式体现。通过线上事故不断迭代和丰富。这个东西不仅在应对故障时可以用到，在线上代码回归测试、影响范围评估层面都有很大的用处。
- 对故障等级进行分类。等级不同，处理流程也不同。1 级是全站不可用；2 级是某功能不可用，且无替代方案；3 级是某功能不可用，但有替代方案；4 级是非功能性故障，或是用户不关心的故障。
- 故障演练。
- 灰度发布系统。针对我们公司的saas系统，我们会针对版本功能选择对应的业务方做小流量发布，测试版本功能的正确性。
**MySQL监控指标**
> CPU 使用率和内存使用率
> 磁盘
> > - 磁盘空间整体使用量
> > - 数据空间使用量
> > - 日志空间使用量
> > - 临时文件空间使用量
> > - 系统文件空间使用量
> IOPS 使用量
> 当前总连接数 & 当前活跃连接数
> 网络流量 
> - 平均每秒输入流量
> - 平均每秒的输出流量
**引擎监控**
> TPS (平均每秒事务数) / QPS(平均每秒SQL语句执行次数)
> InnoDB缓存读命中率、使用率、脏块率（%）
> InnoDB读写量（单位为KB）
> InnoDB缓存请求次数
> > 平均每秒的读次数
> > 平均每秒的写次数
> InnoDB日志读/写/fsync
> > 平均每秒日志写请求数
> > 平均每秒向日志文件的物理写次数
> > 平均每秒向日志文件的完成fsync的次数
> > MySQL执行语句时在硬盘上自动创建的临时表的数量 
> > 运行中的线程数


[1]:	https://www.apiscience.com/
[2]:	http://www.lichengblog.com/zetf007/458.jhtml

[image-1]:	https://tva1.sinaimg.cn/large/008i3skNly1gpw9syos8gj31jc0rigt3.jpg