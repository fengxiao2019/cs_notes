**事务和事务特性**
事务是数据库区别于文件系统的重要特性之一。事务会把系统从一种一致状态转移到另一种一致状态，在数据库提交工作时，可以确保要么所有修改都已经保存了，要么所有修改都不保存。

NDB cluster引擎虽然支持事务，但是不满足D的要求。
InnoDB的RC隔离级别，不满足I的要求，但是RR隔离级别满足ACID特性。
事务的四种特性：ACID。
1. A（Atomic ）原子性：指整个数据库事务时不可分割的工作单位。
2. C （Consistency）一致性：一致性是指事务将数据库一种一致状态转移到另一种一致状态，在事务开始前和事务开始后，数据库的完整性约束没有被破坏。因此，事务时一致性的单位，如果事务中某个动作失败了，系统可以自动撤销事务-返回初始化状态。
3. I（Isolation）隔离性：隔离性要求每个事务的读写对象对其它事务的操作对象能够相互分离，也就是该事务提交前对其他事务都不可见。用锁来保证。
4. D（durability）持久性：事务一旦提交了，其结果就是永久的。即使发生宕机等故障，数据库也能将数据恢复。
---- 
**事务的隔离级别**
SQL 标准定义了四种隔离级别：
1. 读未提交（Read uncommitted）：存在“脏读”的问题。
2. 读提交（Read committed）：存在“幻读”问题，Oracle的默认隔离级别。
3. 可重复读（repeatable read）：InnoDB的默认隔离级别。使用了next-key lock算法，避免了幻读问题。
4. 序列化（serializable）：在此级别下，InnoDB会对每个select语句后面添加`lock in share mode`，为每个读取添加一个共享锁，不再支持一致性非锁定读。该事务主要用于InnoDB存储引擎的分布式事务。

### 事务隔离的实现 - 锁

### 索引
### B+树 vs B树

### 乐观锁 和 悲观锁的区别以及使用场景
### 什么情况下会发生死锁？如何解决死锁？
### 聚簇索引和 非聚簇索引有什么区别？
### 简述Redis 持久化中RDB 以及AOF方案的优缺点？
Redis 提供四种不同程度的持久性选项。
1. RDB（Redis database）：RDB持久化在一定的时间间隔内对数据集建立快照。
2. AOF（Append Only File）：AOF 持久性记录了服务器收到的每一个写操作，这些写操作在服务器重启时会重新执行，用来重建数据集。
3. 没有持久性。
4. AOF + RDB：这种情况下，重新启动时，AOF文件将被用来重建原始数据集，因为AOF文件比RDB文件更能保证数据的完整性。
**RDB的优点**
 1. RDB是一个非常紧凑的文件，非常适用于备份数据，可以根据需要备份不同时间段的数据，在故障恢复时，可以根据需要选择恢复不同版本的数据。
2. RDB由子进程执行，不会阻塞主进程，最大程度上保证了Redis的高性能。
 3. 与AOF相比，在大数据集上RDB能够更快的恢复。
4. 在副本上，RDB支持在重启和故障转移后进行部分重新同步。
**RDB的缺点**
1. 在Redis故障或者其它原因停止工作时，RDB存在丢数据的可能，例如你设置5分钟一个快照，那就有可能丢失5分钟的数据。
2. RDB经常fork，以便使用子进程在磁盘上持久化。如果数据集很大，fork会变得很耗时，可能会导致Redis在几毫秒甚至一秒内停止服务，AOF也需要fork，但是你可以调整写日志的频率。

**AOF的优点**
1. 数据安全，aof 持久化可以配置 appendfsync 属性， _**always**_选项每进行一次 命令操作就记录到 aof 文件中一次。
2. 通过 append 模式写文件，即使中途服务器宕机，可以通过 redis-check-aof 工具解决数据一致性问题。
3. AOF 机制的 rewrite 模式。AOF 文件没被 rewrite 之前（文件过大时会对命令 进行合并重写），可以删除其中的某些命令（比如误操作的 flushall）)
**AOF的缺点**
1. AOF 文件比 RDB 文件大，且恢复速度慢
2. 数据集大的时候，比 rdb 启动效率低
> 如何选择？
### Redis如何实现分布式锁？
![][image-1]
分布式锁必须满足以下三个属性：
1. 安全属性：互斥性。任何时刻只有一个客户可以拥有锁。
2. 有效性A：无死锁。最终总会有可能获得锁。
3. 有效性B：容错。只要大多数节点正常，客户端就可以获取和释放锁。
**单实例下的实现方式**
1. 加锁
```Redis
SET resource_name my_random_value NX PX 30000
```
命令只有在resource_name不存在时才会设置成功，过期时间为3000毫秒（PX选项），对应的值my_random_value在所有客户端和所有锁清秋中都必须是唯一的。
my_random_vale 的唯一性保证保证可以用于释放锁时避免被其他client误删，client只能删除自己创建的锁。

2. 释放锁
```Redis
if redis.call("get",KEYS[1]) == ARGV[1] then
    return redis.call("del",KEYS[1])
else
    return 0
end
```
因为释放锁的过程需要先获取锁，然后检查锁、释放锁（ciient只能删除自己建的锁）。为了将这些步骤以事务的方式执行，就需要借助lua脚本实现。
> **如何选择random str?**
> > 可以采用linux 微秒数 + client id
**多实例模式下** RedLock
单实例模式下，有单点风险。在分布式版本下，采用多个Redis实例，这些实例之间相互独立。为了获取锁，客户端需要执行以下步骤：
1. 获取当前时间（单位为毫秒）
2. 试图依次在所有的N个实例中获取锁，在所有的实例中使用相同的key 和 value（随机值），在设置的过程中，set命令中px选择一个相对锁自动释放时间很小的值，可以防止client试图与Redis节点对话长时间受阻：如果一个实例不可用，尽快试试下一个。
3. client 当前时间减去第一步中的时间，认为是获取锁花费的时间。如果client能够获取多数实例（N/2 + 1），并且锁还在有效期内，才被认为client拿到了锁。
4. 如果client没有拿到锁（要么无法锁定N/2 + 1个实例，要么锁有效时间\< 获取锁的时间），client尝试解锁所有实例。
### 简述Redis中如何防止缓存雪崩和缓存击穿？
![][image-2]
#### 缓存雪崩
**描述**
大量的应用请求无法在 Redis 缓存中进行处理，紧接着，应用将大量请求发送到数据库层，导致数据库层的压力激增。
**原因**
1. 缓存中有大量数据同时过期，导致大量请求无法得到处理。
2. 缓存实例宕机。
**解决办法**
1. 避免给大量数据设置相同的过期时间，可以在设置过期时间时添加一个较小的随机数。
2. 不设置过期时间（电商首页商品缓存）。
3. 服务降级。非核心业务直接返回空值，不读数据库，值保留核心业务的读库能力。
4. 业务系统中实现服务熔断或请求限流机制。服务熔断：业务应用调用缓存接口时，缓存客户端并不把请求发给 Redis 缓存实例，而是直接返回，等到 Redis 缓存实例重新恢复服务后，再允许应用请求发送到缓存系统。
5. 事前预防，主从节点的方式构建 Redis 缓存高可靠集群。如果 Redis 缓存的主节点故障宕机了，从节点还可以切换成为主节点，继续提供缓存服务，避免了由于缓存实例宕机而导致的缓存雪崩问题。
#### 缓存击穿
缓存击穿是指，针对**某个访问非常频繁的热点数据的请求，无法在缓存中进行处理**，紧接着，访问该数据的大量请求，一下子都发送到了后端数据库，导致了数据库压力激增，会影响数据库处理其他请求。缓存击穿的情况，经常发生在热点数据过期失效时。
解决办法：
1. 对于访问特别频繁的热点数据，我们就不设置过期时间了
2. 添加互斥锁
#### 缓存穿透
指要访问的数据既不在 Redis 缓存中，也不在数据库中，导致请求在访问缓存时，发生缓存缺失，再去访问数据库时，发现数据库中也没有要访问的数据。
应用也无法从数据库中读取数据再写入缓存，来服务后续请求，这样一来，缓存也就成了“摆设”，如果应用持续有大量请求访问数据，就会同时给缓存和数据库带来巨大压力。
**原因**
1. 业务层误操作：缓存中的数据和数据库中的数据被误删除了，所以缓存和数据库中都没有数据；
2. 恶意攻击：专门访问数据库中没有的数据。
**解决方案**
1. 缓存空值或缺省值。
2. 使用布隆过滤器快速判断数据是否存在，避免从数据库中查询数据是否存在，减轻数据库压力。正是基于布隆过滤器的快速检测特性，我们可以在把数据写入数据库时，使用布隆过滤器做个标记。当缓存缺失后，应用查询数据库时，可以通过查询布隆过滤器快速判断数据是否存在。如果不存在，就不用再去数据库中查询了。这样一来，即使发生缓存穿透了，大量请求只会查询 Redis 和布隆过滤器，而不会积压到数据库，也就不会影响数据库的正常运行。布隆过滤器可以使用 Redis 实现，本身就能承担较大的并发访问压力。
3. 在请求入口进行请求检测。缓存穿透的一个原因是有大量的恶意请求访问不存在的数据，所以，一个有效的应对方案是在请求入口前端，对业务系统接收到的请求进行合法性检测，把恶意的请求（例如请求参数不合理、请求参数是非法值、请求字段不存在）直接过滤掉，不让它们访问后端缓存和数据库。

### Redis有几种数据结构？对应的底层数据结构？
**概述**
从使用者的角度看，Redis的数据结构包括：
- Binary-safe strings、Lists、Sets、Sorted sets、Hashes、Bit arrays 、HyperLogLogs、Streams。
从内部实现的角度，有以下几种数据结构：
- dict、sds、ziplist、quicklist、skiplist
使用者角度的数据结构和底层数据结构之间的关系：
- Binary-safe strings：简单动态字符串（SDS）
- Lists：双向链表+压缩列表（zipList）
- Hash：压缩列表（zipList）+ hash表
- Sorted Set：ZipList + SkipList
- Set：hash表 + 整数数组
**二进制安全字符串的实现原理**
在C语言中，字符串是以’\0’字符结尾（NULL结束符）的字符数组来存储的，通常表达为字符指针的形式（char *）。它不允许字节0出现在字符串中间，因此，它不能用来存储任意的二进制数据。
sds类型的定义实际上也是char *。
```c
typedef char *sds;
```
所以，要完成二进制安全这个属性，就必须要有一个当前长度的属性。
这个长度存储sds的head里面。为了能让不同长度的字符串可以使用不同大小的header，这样短字符串就能使用较小的header，达到节省内存的目的，sds定义了5种不同类型的header。

**Zset的实现原理**
**hash的实现原理**
**HyperLogLogs的实现原理**
**Streams的实现原理**

### 简述 Redis 的哨兵机制？
### Redis的缓存淘汰策略有哪些？
### 简述 Redis 中跳表的应用以及优缺点
### 简述 Redis 的过期机制和内存淘汰策略
### 简述 Redis 的线程模型以及底层架构设计
### 简述 Redis 如何处理热点 key 访问
### redis 如何实现高可用？
### 简述 Redis 的通信模型？
### Redis 中，sentinel 和 cluster 的区别和适用场景是什么？
### Redis 如何实现主从同步？

### 假设Redis 的 master 节点宕机了，你会怎么进行数据恢复？
### 简述 Redis 集群配置以及基础原理

### MySQL为什么会使用InnoDB作为默认选项？
### 简述什么是最左匹配原则
### MySQL中 InnoDB 和 MylSAM 的区别是什么？
### 简述数据库中什么情况下进行分库，什么情况下进行分表？
### 数据库如何设计索引，如何优化查询？
### 简述一致性哈希算法的实现方式及原理
### 简述数据库中的 ACID 分别是什么？
### 联合索引的存储结构是什么？
### 什么是 SQL 注入攻击？如何防止这类攻击？
### MySQL 有哪些常见的存储引擎？它们的区别是什么？
### 简述 MySQL 常见索引类型，介绍一下覆盖索引
### 唯一索引与普通索引的区别是什么？使用索引会有哪些优缺点？
### 数据库有哪些常见索引？数据库设计的范式是什么？
### 简述事务的四大特性
### 数据库索引的实现原理是什么？
### SQL优化的方案有哪些，如何定位问题并解决问题？

### 简述 MySQL 的间隙锁
### MySQL 联合索引底层原理是什么？
### Redis 序列化有哪些方式？
### MySQL 的索引什么情况下会失效？
### 简述 MySQL 的主从同步机制，如果同步失败会怎么样？
### 简述 MySQL 三种日志的使用场景
### 数据库的读写分离的作用是什么？如何实现？
### MySQL 中 join 与 left join 的区别是什么？
### 简述主从复制以及读写分离的使用场景
### 如何解决缓存与数据库不一致的问题？
### MySQL 有什么调优的方式？
### B+ 树中叶子节点存储的是什么数据
### 简述 SQL 中左连接和右连接的区别
### 简述 MySQL MVCC 的实现原理
### B+ 树叶子节点存储的是什么数据
### 简述数据库事务复制原理
### MySQL 索引使用什么数据结构？
### 假设建立联合索引 (a, b, c) 如果对字段 a 和 c 查询，会用到这个联合索引吗？
### Kafka 发送消息是如何保证可靠性的？
### MySQL 常用的聚合函数有哪些？
### 简述常见的负载均衡算法
### 什么时候索引会失效？
### 简述 undo log 和 redo log 的作用
### 如何解决主从不一致的问题？
### MySQL 中 varchar 和 char 的区别是什么？
### 数据库查询中左外连接和内连接的区别是什么？
### 并发事务会引发哪些问题？如何解决？
### 如何定位以及优化数据库慢查询
### 数据库主键索引和唯一索引有什么区别？
### 如何设计数据库压测方案？
### 数据库反范式设计会出现什么问题？

### 模糊查询是如何实现的？
### 数据库索引的叶子结点为什么是有序链表？
### 寻找两个正序数组的中位数 (Leetcode)
### 什么是公平锁？什么是非公平锁？



[image-1]:	https://tva1.sinaimg.cn/large/008i3skNly1gptjbjnr6zj30u01141kx.jpg
[image-2]:	https://tva1.sinaimg.cn/large/008i3skNly1gptbrmedtxj31wm0u0wre.jpg