InnoDB的多版本使用undo来构建，undo记录中包含了记录更改前的镜像，如果更改数据的事务未提交，对于隔离级别大于等于read commit的事务而言，它不应该看到已修改的数据，而是应该给它返回老版本的数据。
由于在修改聚集索引记录时，总是存储了回滚段指针和事务id，可以通过该指针找到对应的undo 记录，通过事务Id来判断记录的可见性。当旧版本记录中的事务id对当前事务而言是不可见时，则继续向前构建，直到找到一个可见的记录或者到达版本链尾部。

对于聚集索引我们知道其记录中存有修改该记录的**事务id**，我们可以直接判断是否需要构建老版本(`lock_clust_rec_cons_read_sees`)，但对于二级索引记录，并未存储事务id，而是每次更新记录时，同时更新记录所在的page上的事务id（`PAGE_MAX_TRX_ID`），如果该事务id对当前事务是可见的，那么就无需去构建老版本了，否则就需要去回表查询对应的聚集索引记录，然后判断可见性（`lock_sec_rec_cons_read_sees`）。

更详细的讲解：
[http://mysql.taobao.org/monthly/2015/04/01/][1]

[1]:	http://mysql.taobao.org/monthly/2015/04/01/